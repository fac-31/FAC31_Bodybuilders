import click
from pathlib import Path

MUSCLE_ASCII = r"""
...........................................:+*#%%%#=................................................
..........................................=%%%%%@@@@#:..............................................
.........................................:@@%%%%%@@@@+..............................................
.........................................-@@%%%%%@@@@*..............................................
.........................................-@@@%%%%@@%%+..............................................
.........................................-%%@@@@@@*=#+=:............................................
..........................................-+@@@%*+==:+-.............................................
...........................................*@@%###%*:...............................................
........................................::-#@@@*#@@%=:..............................................
.....................................:-==+#@@@@=-**@#+-.  ..........................................
....................................=*=-=*%@@@@@@%%@%+=-::...::.....................................
...............................::-:-+-=*#%#%@@@@@@@%*-::::--:...:...................................
............................:*+-++:...---::::---=#%*=-:.   .:==:.::::...............................
............................+#+-*+-=+***=:. ..::=*#+-:.    :*%%#+====+-.............................
............................%#**###%@@%*-.     .=##+-.    .:=#@@@@%#*#+ ............................
..........................-+@%#%@@@@@@%*+=:.. .:=#%#+=---=++*#@@@%*+*%#:............................
.........................-++#@#=:-+%@@@@@%#*==-=*#@@%####%%%@@@%-   +=--:...........................
........................:*=*-:*+:.:*@@@@@@@@%%%%#=+%@@@@@@@@@@@%*----  =++..........................
........................+@%#- .+++#@@@@@@@@@@@*-..--=%@@@@@@@@@@@%+--. :+*-.........................
.......................:#%#+--=-+%@@%@@@@@%*#%*+=+##++#%@@@@@@@@@@%+-==----.........................
.......................-#=:=**++#%@@@@@@@%#+*+:::=#@*==+#%%=@@@%--@@#*%*-.::........................
.......................+=.:+@@%@#:=#@@%#@%#%@%####%%***#@@%-*#-...:*%@@@*: :-.......................
......................-#: .+@@%+....-*#*##+*%*+++*%%@@@@@@@+:........*%%*: .*.......................
......................=%: .=*#........:+#=-:*#=--+%#***###@:.........:+++:.=#.......................
.....................*##*::=-:.........=%*-..=*+=====+#@@+*+ .........=#*-:-+*=.....................
....................-#*+*=:=*-..........#@%*=+*#*++=-+#@%=*#..........-@%#====+:....................
....................:#=-:=+%%:........:*@%#%%*=+#*+++*%@#*%-...........=@@*:..*:....................
.....................#+: =#*:........:#@@@@%*#*=+*+**#%@+*#=-...........:%#+.:#:....................
.....................+@=.++.........:%@@@@@@@@@%*****#%%=%+*@=...........:##:+#.....................
.....................-%*-*:.........=@@@@@@@@@@@@@@%%%@%%@@@%%#-..........-#--+.....................
.....................=*+--..........-@@@@%@@@@@@@@@@@@@@@@%%%##%+..........-:-+-....................
.....................=%+-:..........=@*%*-:+%@@@@@@@%%%##%@@@@%@@:.......::::=*:....................
.....................:%+--+=:.......:=-*+. .-%@@@@@@@@@@%%%%%%%%+.......:*#=:-+.....................
......................##--+%+:.......--=+. .-##@@@@@@@@@@@@@@@@@*.......*#*=+#+.....................
......................+@@%***-......:+:.=: .=#=**@@@@@@@@@@@@@@@@+......-##%%#-.....................
.......................--=+=.......:#*: =- .+#=+=#%@@@@@@@@@@@%#%+........::........................
...................................=%#-.-=:=#+**+*#@@@@@@@@@@*--**:.................................
...................................*@#+=-**=-:=*#%%@@@@@%%%%#++##@*.................................
...................................*@%++**%+..=*@%@@@@@@%%+:##+#%@*.................................
............WELCOME................=@@#*#%#=.:=*%@@@@@@@%*- =%#%@@=.................................
.............TO....................:%@@%%@%+--+#@#@@@@@%#*-:=*%@@@:.................................
..............BODYBUILDERS..........-@@@@@@#++*%+.+@@@@%#+==+*@@@*..................................
.....................................=@@%*%@##%@-..+@@@@%*++*%@@%:..................................
......................................%@%++@@@@%....+@@@@%###@@*....................................
......................................#@*--#@@@-....:%@@@@@@@@+.....................................
......................................#@%**%@@*......*@@@@@@@@*.....................................
.....................................:%@%%%@*%:......-@##%@@@@#.....................................
.....................................*%@%%@@%=.......+@@**%@@@:.....................................
...................................=#*=:##%%.......:*%*@@@@@%.......................................
..................................:%@#--*%@#:.....:*#*-*@@%@#.......................................
..................................:+==:--==-:.....:==-:-=====.......................................
"""

@click.command()
@click.option('--output', '-o', default=".mutignore", help="Path to existing .mutignore")
@click.option('--auto', is_flag=True, help="Run non-interactively (CI mode)")
def setup_mutation(output, auto):
    """Interactive CLI to set up project-specific files and mutation severity."""
    click.clear()
    click.echo(click.style(MUSCLE_ASCII, fg="white"))
    click.echo(click.style("Welcome Body Builder!", fg="green", bold=True))

    path = Path(output)
    if not path.exists():
        click.echo(click.style(f"⚠️ {output} not found!", fg="red"))
        return

    # --- Ask for project-specific files ---
    project_specific = []
    if not auto and click.confirm("Would you like to add project-specific files or folders to protect?"):
        while True:
            pattern = click.prompt("Enter a file or directory (leave blank to finish)", default="", show_default=False)
            if not pattern:
                break
            project_specific.append(pattern)

    if project_specific:
        with path.open("a") as f:
            f.write("\n# Project-specific protected files\n")
            f.write("\n".join(project_specific) + "\n")
        click.echo(click.style(f"✅ Added {len(project_specific)} project-specific entries.", fg="green"))

    # --- Ask for workout plan (mutation severity) ---
    if not auto:
        click.echo("\nChoose your workout plan:")
        workout = click.prompt(
            "Options: [light / medium / hardcore]",
            type=click.Choice(['light', 'medium', 'hardcore'], case_sensitive=False)
        )
        click.echo(click.style(f" Selected workout plan: {workout.upper()}", fg="cyan", bold=True))
    else:
        workout = "medium"  # default for CI
        click.echo(f"Running in auto mode: workout plan = {workout}")

    # Save configuration
    config_path = Path(".mutation-config.txt")
    config_path.write_text(f"mutation_severity={workout}\n")
    click.echo(f"Configuration saved to {config_path.resolve()}")


if __name__ == "__main__":
    setup_mutation()